!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.upsesy=t():e.upsesy=t()}(self,(()=>(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var s=n.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t+"../"})();var t={};function n(e,t){return e.start<t.start}function s(){return new Date(Date.now())}function r(e,t=2,n=":"){return String(e.getHours()).padStart(t,"0")+n+String(e.getMinutes()).padStart(t,"0")}function i(e){document.getElementById("countdown").innerHTML=r(e)}e.r(t),e.p;class a{constructor(e,t,n){this.start=e,this.end=t,this.showclock=n}remaining(e){return this.end?this.end-e:1}isrunning(e){return this.start<=e&&this.end>e}_draw(e,t){this.showclock?i(e):this.update(t)}startTime(){return String(this.start.getHours())}run(e){var t=s(),n=this.remaining(t);this._draw(t,n);var r=setInterval((()=>{t=s(),(n=this.remaining(t))<0?(clearInterval(r),e.advanceSession()):this._draw(t,n)}),1e3)}description(){throw new Error("Not implemented!")}nextDescription(){return this.description()+" @ "+r(this.start)}prepare(){throw new Error("Implement prepare function")}update(e){throw new Error("Implement update function")}cleanup(){throw new Error("Implement cleanup function")}}class o extends a{static SEG_CONTENT=0;static SEG_QUESTIONS=1;static SEG_GRACETIME=2;constructor(e,t,n,s,r,i,a){const o=new Date(t.getTime()+(n+s+r));super(t,o,a),this.speaker=e,this.content=n,this.questions=s,this.gracetime=r,this.warnspeaker=i,this.speakerwarned=!1,this.talkSegment=0}remaining(e){const t=super.remaining(e);return this._updateTalkSegment(t),this.talkSegment===o.SEG_CONTENT?t-(this.questions+this.gracetime):this.talkSegment===o.SEG_QUESTIONS?t-this.gracetime:t}description(){return this.speaker}_updateTalkSegment(e){e>this.questions+this.gracetime?this.talkSegment=o.SEG_CONTENT:e>this.gracetime?(this.talkSegment=o.SEG_QUESTIONS,this.speakerwarned&&this._clearWarning()):this.talkSegment=o.SEG_GRACETIME}_clearWarning(){document.getElementById("countdown").classList.remove("has-text-warning"),this.speakerwarned=!1}prepare(){document.getElementById("currentSpeaker").innerHTML="Currently: "+this.description(),document.getElementById("upsesy").classList.add("is-talk"),this.talksegment=this.SEG_CONTENT}update(e){!function(e){const t=String(Math.floor(e%36e5/6e4)),n=String(Math.floor(e%6e4/1e3));document.getElementById("countdown").innerHTML=t.padStart(2,"0")+":"+n.padStart(2,"0")}(e),!this.speakerwarned&&this.talkSegment==o.SEG_CONTENT&&e<this.warnspeaker&&(console.log("WARNING"),document.getElementById("countdown").classList.add("has-text-warning"),this.speakerwarned=!0)}cleanup(){document.getElementById("upsesy").classList.remove("is-talk"),this._clearWarning()}}class c extends a{constructor(e,t,n,s){super(t,n,s),this.desc=e}description(){return this.desc}prepare(){document.getElementById("currentSpeaker").innerHTML="Currently: "+this.description(),document.getElementById("upsesy").classList.add("is-pause")}update(e){}cleanup(){document.getElementById("upsesy").classList.remove("is-pause")}}class u extends a{constructor(e){super(e,null,!0)}description(){return"Session has ended"}prepare(){document.getElementById("currentSpeaker").innerHTML=this.description(),document.getElementById("upsesy").classList.add("is-pause")}update(e){}cleanup(){document.getElementById("upsesy").classList.remove("is-pause")}}class l{constructor(e,t,s){this.upcoming=Array(),this.past=Array(),e.thetalks.forEach((e=>{let n=null;if("regular"==e.kind)n=function(e,t){let n=1e3,s=1e3,r=1e3;e.lengths?(n=e.lengths.content*n,s=e.lengths.questions*s,r=e.lengths.gracetime*r):(n=t.content*n,s=t.questions*s,r=t.gracetime*r);const i=e.speaker,a=new Date(e.start),c=e.showclock,u=new o(i,a,n,s,r,1e3*t.warnspeaker,c);return console.log(u),u}(e,t);else{if("pause"!=e.kind)throw new Error("Do not know this kind of talk ",e.kind);n=function(e,t){const n=1e3*(e.lengths?e.lengths.content:t.content),s=e.speaker,r=new Date(e.start),i=new Date(r.getTime()+n),a=e.showclock;return new c(s,r,i,a)}(e,t)}n.end<s?this.past.push(n):this.upcoming.push(n)})),this.upcoming=this.upcoming.sort(n),this.past=this.past.sort(n),this.interval=null}advanceSession(){this.current&&this.current.cleanup(),this._updateCurrentTalk(),this._displayNext(),this.current.prepare(),console.log("Next running ",this.current),this.current.run(this)}runSession(){this.interval&&clearInterval(this.interval),this.advanceSession()}_lastTalkRunning(){return null===this._nextTalk()}_endOfSession(){return null===this._nextTalk()&&null===this.current}_updateCurrentTalk(){this.past.push(this.current);const e=s(),t=this._nextTalk();var n,r;t?t.isrunning(e)?this.current=this.upcoming.pop():this.current=(n=e,r=t.start,new c("Session is paused",n,r,!0)):this.current=new u(e)}_nextTalk(){return 0===this.upcoming.length?null:this.upcoming.at(-1)}_displayNext(){this._lastTalkRunning()?(document.getElementById("nextSpeaker").classList.add("has-text-info"),document.getElementById("nextSpeaker").innerHTML="Next"):document.getElementById("nextSpeaker").innerHTML="Next: "+this._nextTalk().nextDescription()}}function d(e){!function(){const e=window.setInterval((function(){}),Number.MAX_SAFE_INTEGER);for(let t=1;t<e;t++)window.clearInterval(t)}(),document.getElementById("currentSpeaker").classList.remove("has-text-light"),document.getElementById("nextSpeaker").classList.remove("has-text-light");const t=e.currentTarget.value;document.getElementById("sessionSelector").innerHTML=t,new l(schedule.sessions[t],schedule.global,s()).runSession()}return window.onload=function(){i(s()),setInterval((()=>{i(s())}),1e3);const e=document.getElementById("sessionList");schedule=JSON.parse(schedule),Object.keys(schedule.sessions).forEach((t=>{const n=document.createElement("a");n.classList.add("navbar-item"),n.innerHTML=t,n.value=t,n.addEventListener("click",d),e.appendChild(n)}))},t})()));